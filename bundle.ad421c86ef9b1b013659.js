(()=>{"use strict";var e,t,r,a={},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return a[e](r,r.exports,s),r.exports}s.m=a,s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>"bundle."+{194:"62a119073bc66a1a2da2",431:"e22e7fa722bcce589ab8",847:"291c503c2d4b0c2174b8",851:"995e3cc13b6b5ec059fb",895:"6f9eddfc91b25a2c4a54"}[e]+".js",s.miniCssF=e=>e+".styles.css",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="spotipack:",s.l=(r,a,o,i)=>{if(e[r])e[r].push(a);else{var n,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){n=d;break}}n||(l=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,s.nc&&n.setAttribute("nonce",s.nc),n.setAttribute("data-webpack",t+o),n.src=r),e[r]=[a];var u=(t,a)=>{n.onerror=n.onload=null,clearTimeout(p);var o=e[r];if(delete e[r],n.parentNode&&n.parentNode.removeChild(n),o&&o.forEach((e=>e(a))),t)return t(a)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),l&&document.head.appendChild(n)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{if("undefined"!=typeof document){var e=e=>new Promise(((t,r)=>{var a=s.miniCssF(e),o=s.p+a;if(((e,t)=>{for(var r=document.getElementsByTagName("link"),a=0;a<r.length;a++){var o=(i=r[a]).getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(o===e||o===t))return i}var s=document.getElementsByTagName("style");for(a=0;a<s.length;a++){var i;if((o=(i=s[a]).getAttribute("data-href"))===e||o===t)return i}})(a,o))return t();((e,t,r,a,o)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",s.nc&&(i.nonce=s.nc),i.onerror=i.onload=r=>{if(i.onerror=i.onload=null,"load"===r.type)a();else{var s=r&&r.type,n=r&&r.target&&r.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+s+": "+n+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=s,l.request=n,i.parentNode&&i.parentNode.removeChild(i),o(l)}},i.href=t,r?r.parentNode.insertBefore(i,r.nextSibling):document.head.appendChild(i)})(e,o,null,t,r)})),t={792:0};s.f.miniCss=(r,a)=>{t[r]?a.push(t[r]):0!==t[r]&&{194:1,431:1,847:1,851:1,895:1}[r]&&a.push(t[r]=e(r).then((()=>{t[r]=0}),(e=>{throw delete t[r],e})))}}})(),(()=>{var e={792:0};s.f.j=(t,r)=>{var a=s.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var o=new Promise(((r,o)=>a=e[t]=[r,o]));r.push(a[2]=o);var i=s.p+s.u(t),n=new Error;s.l(i,(r=>{if(s.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var o=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",n.name="ChunkLoadError",n.type=o,n.request=i,a[1](n)}}),"chunk-"+t,t)}};var t=(t,r)=>{var a,o,[i,n,l]=r,c=0;if(i.some((t=>0!==e[t]))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(l)l(s)}for(t&&t(r);c<i.length;c++)o=i[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkspotipack=self.webpackChunkspotipack||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();class i{constructor(){this._expiresAt=0,this._accessToken=null,this._refreshToken=null,this._codeChallenge=null,this._codeVerifier=null,this._codeCallback=null}async authenticate(){console.info("Authenticating...");const e=(e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return crypto.getRandomValues(new Uint8Array(e)).reduce(((e,r)=>e+t[r%62]),"")})(64),t=await(async e=>{const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)})(e),r=(a=t,btoa(String.fromCharCode(...new Uint8Array(a))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"));var a;this._codeVerifier=e,this._codeChallenge=r;const o={response_type:"code",client_id:"7e9935a5e5d84840b8b26ee8fb9678be",redirect_uri:"http://localhost:3000/#callback",code_challenge_method:"S256",code_challenge:this._codeChallenge,scope:"user-top-read user-read-email user-read-private"};localStorage.setItem("codeVerifier",this._codeVerifier),localStorage.setItem("codeChallenge",this._codeChallenge);let s=new URL("https://accounts.spotify.com/authorize");s.search=new URLSearchParams(o).toString(),window.location.href=s.toString()}async refreshTokens(e="refresh_token"){let t;if("authorization_code"===e){if(!this._codeVerifier||!this._codeCallback)throw new Error("No code verifier or code callback");console.info("Exchanging code for tokens..."),t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:"7e9935a5e5d84840b8b26ee8fb9678be",grant_type:"authorization_code",code:this._codeCallback,redirect_uri:"http://localhost:3000/#callback",code_verifier:this._codeVerifier})}}else{if(!this._refreshToken)throw new Error("No refresh token");console.info("Refreshing token..."),t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({CLIENT_ID:"7e9935a5e5d84840b8b26ee8fb9678be",grant_type:"refresh_token",refresh_token:this._refreshToken||""})}}const r=await fetch(new URL("https://accounts.spotify.com/api/token"),t);if(!r.ok)throw new Error("Error while refreshing tokens");const a=await r.json();if(!a.access_token||!a.refresh_token||!a.expires_in)throw new Error("Error while refreshing tokens");this._accessToken=a.access_token,this._refreshToken=a.refresh_token,this._expiresAt=Date.now()+1e3*a.expires_in,this.storeAccessToken(),this.storeRefreshToken(),this.storeExpiresAt()}printTokens(){let e={accessToken:this._accessToken,refreshToken:this._refreshToken,expiresAt:this._expiresAt,codeVerifier:this._codeVerifier,codeChallenge:this._codeChallenge,codeCallback:this._codeCallback};console.table(e)}isExpired(){return Date.now()>=this._expiresAt}isAuthentified(){return!(!this._accessToken||this.isExpired())}getAccessToken(){return this.isExpired()?this.refreshTokens():this._accessToken||(this._accessToken=localStorage.getItem("access_token")),this._accessToken}restoreTokens(){return this._codeVerifier=localStorage.getItem("codeVerifier"),this._codeChallenge=localStorage.getItem("codeChallenge"),this._accessToken=localStorage.getItem("access_token"),this._refreshToken=localStorage.getItem("refresh_token"),this._expiresAt=parseInt(localStorage.getItem("expires_at")||"0"),!!this.isAuthentified()}storeAccessToken(){if(!this._accessToken)throw new Error("No access token to store");localStorage.setItem("access_token",this._accessToken)}storeRefreshToken(){if(!this._refreshToken)throw new Error("No refresh token to store");localStorage.setItem("refresh_token",this._refreshToken)}storeExpiresAt(){if(!this._expiresAt)throw new Error("No expiration date to store");localStorage.setItem("expires_at",this._expiresAt.toString())}async handleSpotifyCallback(){if(this.restoreTokens(),!this._codeVerifier||""===this._codeVerifier)return console.error("No code verifier"),void window.router.navigateTo("home",{error:"Pas de code de vérification"});let e=new URLSearchParams(window.location.search).get("code");if(!e||""===e)return console.error("No code in URL"),void window.router.navigateTo("home",{error:"Pas de code de callback"});this._codeCallback=e,await this.refreshTokens("authorization_code"),await this.isAuthentified()?(console.info("Succesfuly authenticated!"),window.router.navigateTo("me")):(console.error("Authentication failed"),window.router.navigateTo("home",{error:"Authentification échouée"})),this.cleanUrlParams()}cleanUrlParams(){const e=new URL(window.location.href);e.search="",window.history.replaceState({},document.title,e.toString())}logout(){this._expiresAt=0,this._accessToken=null,this._refreshToken=null,this._codeVerifier=null,this._codeChallenge=null,this._codeCallback=null,localStorage.clear(),window.router.navigateTo("home")}}function n(e){return e.album?{id:e.id,name:e.name,duration:e.duration_ms,popularity:e.popularity,explicit:e.explicit,trackNumber:e.track_number,imageURL:new URL(e.album.images[0].url),trackURL:new URL(e.external_urls.spotify),previewURL:new URL(e.preview_url),album:c(e.album),artists:e.artists.map(l)}:{id:e.id,name:e.name,duration:e.duration_ms,explicit:e.explicit,trackNumber:e.track_number,imageURL:new URL(e.album.images[0].url),trackURL:new URL(e.external_urls.spotify),previewURL:new URL(e.preview_url),artists:e.artists.map(l)}}function l(e){return e.genres?{id:e.id,name:e.name,popularity:e.popularity,genres:e.genres,followers:e.followers.total,artistURL:new URL(e.external_urls.spotify),pictureURL:new URL(e.images[0].url)}:{id:e.id,name:e.name,artistURL:new URL(e.external_urls.spotify)}}function c(e){return e.genres?{id:e.id,name:e.name,releaseDatePrecision:e.release_date_precision,releaseDate:new Date(e.release_date),totalTracks:e.total_tracks,albumType:e.album_type,albumURL:new URL(e.external_urls.spotify),pictureURL:new URL(e.images[0].url),copyright:e.label,label:e.label,genres:e.genres,artists:e.artists.map(l),tracks:e.tracks.map(n)}:{id:e.id,name:e.name,releaseDatePrecision:e.release_date_precision,releaseDate:new Date(e.release_date),totalTracks:e.total_tracks,albumType:e.album_type,albumURL:new URL(e.external_urls.spotify),pictureURL:new URL(e.images[0].url),artists:e.artists.map(l)}}!function(e){e[e.acoustic=0]="acoustic",e[e.afrobeat=1]="afrobeat",e[e["alt-rock"]=2]="alt-rock",e[e.alternative=3]="alternative",e[e.ambient=4]="ambient",e[e.anime=5]="anime",e[e["black-metal"]=6]="black-metal",e[e.bluegrass=7]="bluegrass",e[e.blues=8]="blues",e[e.bossanova=9]="bossanova",e[e.brazil=10]="brazil",e[e.breakbeat=11]="breakbeat",e[e.british=12]="british",e[e.cantopop=13]="cantopop",e[e["chicago-house"]=14]="chicago-house",e[e.children=15]="children",e[e.chill=16]="chill",e[e.classical=17]="classical",e[e.club=18]="club",e[e.comedy=19]="comedy",e[e.country=20]="country",e[e.dance=21]="dance",e[e.dancehall=22]="dancehall",e[e["death-metal"]=23]="death-metal",e[e["deep-house"]=24]="deep-house",e[e["detroit-techno"]=25]="detroit-techno",e[e.disco=26]="disco",e[e.disney=27]="disney",e[e["drum-and-bass"]=28]="drum-and-bass",e[e.dub=29]="dub",e[e.dubstep=30]="dubstep",e[e.edm=31]="edm",e[e.electro=32]="electro",e[e.electronic=33]="electronic",e[e.emo=34]="emo",e[e.folk=35]="folk",e[e.forro=36]="forro",e[e.french=37]="french",e[e.funk=38]="funk",e[e.garage=39]="garage",e[e.german=40]="german",e[e.gospel=41]="gospel",e[e.goth=42]="goth",e[e.grindcore=43]="grindcore",e[e.groove=44]="groove",e[e.grunge=45]="grunge",e[e.guitar=46]="guitar",e[e.happy=47]="happy",e[e["hard-rock"]=48]="hard-rock",e[e.hardcore=49]="hardcore",e[e.hardstyle=50]="hardstyle",e[e["heavy-metal"]=51]="heavy-metal",e[e["hip-hop"]=52]="hip-hop",e[e.holidays=53]="holidays",e[e["honky-tonk"]=54]="honky-tonk",e[e.house=55]="house",e[e.idm=56]="idm",e[e.indian=57]="indian",e[e.indie=58]="indie",e[e["indie-pop"]=59]="indie-pop",e[e.industrial=60]="industrial",e[e.iranian=61]="iranian",e[e["j-dance"]=62]="j-dance",e[e["j-idol"]=63]="j-idol",e[e["j-pop"]=64]="j-pop",e[e["j-rock"]=65]="j-rock",e[e.jazz=66]="jazz",e[e["k-pop"]=67]="k-pop",e[e.kids=68]="kids",e[e.latin=69]="latin",e[e.latino=70]="latino",e[e.malay=71]="malay",e[e.mandopop=72]="mandopop",e[e.metal=73]="metal",e[e["metal-misc"]=74]="metal-misc",e[e.metalcore=75]="metalcore",e[e["minimal-techno"]=76]="minimal-techno",e[e.movies=77]="movies",e[e.mpb=78]="mpb",e[e["new-age"]=79]="new-age",e[e["new-release"]=80]="new-release",e[e.opera=81]="opera",e[e.pagode=82]="pagode",e[e.party=83]="party",e[e["philippines-opm"]=84]="philippines-opm",e[e.piano=85]="piano",e[e.pop=86]="pop",e[e["pop-film"]=87]="pop-film",e[e["post-dubstep"]=88]="post-dubstep",e[e["power-pop"]=89]="power-pop",e[e["progressive-house"]=90]="progressive-house",e[e["psych-rock"]=91]="psych-rock",e[e.punk=92]="punk",e[e["punk-rock"]=93]="punk-rock",e[e["r-n-b"]=94]="r-n-b",e[e["rainy-day"]=95]="rainy-day",e[e.reggae=96]="reggae",e[e.reggaeton=97]="reggaeton",e[e["road-trip"]=98]="road-trip",e[e.rock=99]="rock",e[e["rock-n-roll"]=100]="rock-n-roll",e[e.rockabilly=101]="rockabilly",e[e.romance=102]="romance",e[e.sad=103]="sad",e[e.salsa=104]="salsa",e[e.samba=105]="samba",e[e.sertanejo=106]="sertanejo",e[e["show-tunes"]=107]="show-tunes",e[e["singer-songwriter"]=108]="singer-songwriter",e[e.ska=109]="ska",e[e.sleep=110]="sleep",e[e.songwriter=111]="songwriter",e[e.soul=112]="soul",e[e.soundtracks=113]="soundtracks",e[e.spanish=114]="spanish",e[e.study=115]="study",e[e.summer=116]="summer",e[e.swedish=117]="swedish",e[e["synth-pop"]=118]="synth-pop",e[e.tango=119]="tango",e[e.techno=120]="techno",e[e.trance=121]="trance",e[e["trip-hop"]=122]="trip-hop",e[e.turkish=123]="turkish",e[e["work-out"]=124]="work-out",e[e["world-music"]=125]="world-music"}(r||(r={}));class h{constructor(e){this.topArtists=[],this.topTracks=[],this.authManager=e,this.loggedUser=null}get headers(){return{Authorization:"Bearer "+this.authManager.getAccessToken()}}async getLoggedUserInfos(){let e;try{e=await fetch("https://api.spotify.com/v1/me",{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des informations de l'utilisateur:\n"+e)}if(!e.ok)throw new Error("Erreur lors de la récupération des informations de l'utilisateur (status code:"+e.status+")");const t=await e.json();let r={id:t.id,name:t.display_name,email:t.email,country:t.country,followers:t.followers.total,spotifyPlan:t.product,pictureURL:t.images.length>0?new URL(t.images[0].url):new URL("https://placekitten.com/300/300"),userURL:new URL(t.external_urls.spotify),topArtists:[],topTracks:[],topGenres:[]},a=await this.getLoggedUserTopsItems();r.topTracks=a.topTracks,r.topArtists=a.topArtists,this.loggedUser=r,this.getLoggedUserTopsItems()}async getLoggedUserTopsItems(){let e;try{e=await fetch("https://api.spotify.com/v1/me/top/artists?limit=29",{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des informations de l'utilisateur:\n"+e)}if(!e.ok)throw new Error("Erreur lors de la récupération des informations de l'utilisateur (status code:"+e.status+")");let t=await e.json(),r=t.items.map(l);try{e=await fetch("https://api.spotify.com/v1/me/top/tracks",{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des informations de l'utilisateur:\n"+e)}if(!e.ok)throw new Error("Erreur lors de la récupération des informations de l'utilisateur (status code:"+e.status+")");return t=await e.json(),{topArtists:r,topTracks:t.items.map(n)}}async getAlbumInfos(e){let t;try{t=await fetch("https://api.spotify.com/v1/albums/"+e,{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des informations de l'album:\n"+e)}if(!t.ok)throw new Error("Erreur lors de la récupération des informations de l'album (status code:"+t.status+")");let r=await t.json();return{id:r.id,name:r.name,releaseDatePrecision:r.release_date_precision,releaseDate:new Date(r.release_date),totalTracks:r.total_tracks,albumType:r.album_type,pictureURL:new URL(r.images[0].url),albumURL:new URL(r.external_urls.spotify),copyright:r.label,label:r.label,genres:r.genres,artists:[...r.artists],tracks:[...r.tracks]}}async getArtistInfos(e){let t;try{t=await fetch("https://api.spotify.com/v1/artists/"+e,{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des informations de l'artiste:\n"+e)}if(!t.ok)throw new Error("Erreur lors de la récupération des informations de l'artiste (status code:"+t.status+")");let r=await t.json();return{id:r.id,name:r.name,popularity:r.popularity,genres:r.genres,followers:r.followers.total,artistURL:new URL(r.external_urls.spotify),pictureURL:new URL(r.images[0].url)}}async getTrackInfos(e){let t;try{t=await fetch("https://api.spotify.com/v1/tracks/"+e,{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des informations du morceau:\n"+e)}if(!t.ok)throw new Error("Erreur lors de la récupération des informations du morceau (status code:"+t.status+")");let r=await t.json();return{id:r.id,name:r.name,duration:r.duration_ms,popularity:r.popularity,explicit:r.explicit,trackNumber:r.track_number,album:r.album,artists:r.artists,imageURL:new URL(r.album.images[0].url),trackURL:new URL(r.external_urls.spotify),previewURL:new URL(r.preview_url)}}async getArtistTopTracks(e){let t;try{t=await fetch("https://api.spotify.com/v1/artists/"+e+"/top-tracks?market=FR",{headers:this.headers})}catch(e){throw new Error("Erreur lors de la récupération des top morceaux de l'artiste:\n"+e)}if(!t.ok)throw new Error("Erreur lors de la récupération des top morceaux de l'artiste (status code:"+t.status+")");return(await t.json()).tracks.map(n)}}class d{constructor(e,t){this.currentPage=null,this.authManager=e,this.spotify=t,this.pages={home:()=>s.e(847).then(s.bind(s,847)).then((e=>new e.default(this.authManager,this.spotify))),me:()=>s.e(194).then(s.bind(s,194)).then((e=>new e.default(this.authManager,this.spotify))),callback:()=>s.e(431).then(s.bind(s,431)).then((e=>new e.default(this.authManager,this.spotify))),artist:e=>s.e(895).then(s.bind(s,895)).then((t=>new t.default(this.authManager,this.spotify,e?.id))),track:e=>s.e(851).then(s.bind(s,851)).then((t=>new t.default(this.authManager,this.spotify,e?.id)))}}init(){window.addEventListener("popstate",this.handlePopState.bind(this)),this.navigateTo(this.getCurrentPage())}getCurrentPage(){const e=window.location.hash.slice(1),[t]=e.split("?");return t||"home"}getParams(e){const t={},[,r]=e.split("?");if(r){r.split("&").forEach((e=>{const[r,a]=e.split("=");console.log(`Key: ${r}, Value: ${a}`),t[r]=decodeURIComponent(a)}))}return t}async navigateTo(e,t){if(console.info(`Navigating to ${e}`),!["home","callback"].includes(e)&&!this.authManager.isAuthentified())return console.error("Authentification requise pour accéder à la page",e),void this.navigateTo("home",{error:"Authentification requise pour accéder à la page"});if("callback"===e){if(!window.location.search.includes("code"))return console.error("La page 'callback' ne peut pas être atteinte directement"),void this.navigateTo("home",{error:"La page 'callback' ne peut pas être atteinte directement"})}else if(!this.pages[e])return void console.error(`Page "${e}" not found`);let r=`#${e}`;if(t){r+=`?${new URLSearchParams(t).toString()}`}history.pushState(null,"",r),await this.renderPage(e,t)}handlePopState(){const e=this.getCurrentPage(),t=this.getParams(window.location.hash.slice(1));this.renderPage(e,t)}async renderPage(e,t){const r=this.pages[e];r?(this.currentPage&&(this.currentPage.container.innerHTML=""),this.currentPage=await r(t),this.currentPage.render()):console.error(`Page "${e}" not found`)}}class u{constructor(){this.authManager=new i,this.spotify=new h(this.authManager),this.router=new d(this.authManager,this.spotify)}async init(){this.authManager.restoreTokens()&&await this.spotify.getLoggedUserInfos(),window.router=this.router,this.router.init()}}document.addEventListener("DOMContentLoaded",(()=>{(new u).init()}))})();
//# sourceMappingURL=bundle.ad421c86ef9b1b013659.js.map